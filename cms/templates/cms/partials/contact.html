{% load static %}
{% load custom_filters %}

<section id="contact" class="section position-relative overflow-hidden" style="background: linear-gradient(135deg, #1e3a8a, #3b82f6, #ffffff);">
  <!-- Bubble animations -->
  <div class="bubbles position-absolute w-100 h-100" style="top:0; left:0; z-index:1;">
    <span style="--i:11;"></span>
    <span style="--i:15;"></span>
    <span style="--i:18;"></span>
    <span style="--i:22;"></span>
    <span style="--i:25;"></span>
    <span style="--i:30;"></span>
  </div>

  <div class="container position-relative" style="z-index: 2;">
    <h2 class="section-title text-center text-white mb-5">
      <i class="fas fa-headset me-2"></i> Contact Us
    </h2>

    <div class="row g-4">
      <!-- Contact form -->
      <div class="col-lg-6">
        <div class="contact-form bg-white text-dark p-5 rounded-4 shadow-lg">
          <h4 class="mb-4">
            <i class="fas fa-envelope me-2 text-primary"></i> Get in Touch
          </h4>
          <div id="formMessage" class="mb-3"></div>

          <form id="contactForm" method="post" action="{% url 'cms:contact_inquiry' %}" novalidate>
            {% csrf_token %}
            <div class="mb-3">
              <label class="form-label" for="name">Full Name *</label>
              <input id="name" name="name" class="form-control rounded-pill" type="text" required>
            </div>
            <div class="mb-3">
              <label class="form-label" for="email">Email Address *</label>
              <input id="email" name="email" class="form-control rounded-pill" type="email" required>
            </div>
            <div class="mb-3">
              <label class="form-label" for="phone">Phone Number</label>
              <input id="phone" name="phone" class="form-control rounded-pill" type="tel" inputmode="tel">
            </div>
            <div class="mb-3">
              <label class="form-label" for="message">Message *</label>
              <textarea id="message" name="message" class="form-control rounded-3" rows="5" required></textarea>
            </div>
            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary rounded-pill">
                <i class="fas fa-paper-plane me-2"></i>Send Message
              </button>
              <button type="reset" class="btn btn-outline-light rounded-pill">Reset</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Office info + tabs + map -->
      <div class="col-lg-6">
        <div class="office-info bg-opacity-75 text-white p-5 rounded-4 shadow-lg">
          <h5 class="mb-4 text-primary">
            <i class="fas fa-building me-2"></i> Office Locations
          </h5>

          <!-- Tabs -->
          <ul class="nav nav-pills mb-3" id="officeTabs" role="tablist">
            {% for office in offices %}
              {% with office.country|lower|cut:" " as office_key %}
                <li class="nav-item" role="presentation">
                  <button class="nav-link {% if forloop.first %}active{% endif %}" 
                          id="tab-{{ office_key }}" 
                          data-office-index="{{ forloop.counter0 }}"
                          type="button">
                    {{ office.flag_emoji|default:"üåç" }} {{ office.country }}
                  </button>
                </li>
              {% endwith %}
            {% endfor %}
          </ul>

          <!-- Office Details -->
          <div id="officeDetails" class="mb-3 text-dark">
            {% for office in offices %}
              <div class="office-panel {% if not forloop.first %}d-none{% endif %}" data-map="{{ office.google_map_link }}">
                <h6><i class="fas fa-map-marker-alt me-2"></i>{{ office.city }}, {{ office.country }}</h6>
                <p class="mb-1">{% for line in office.address.splitlines %}{{ line }}<br>{% endfor %}</p>
                <p class="mb-1"><i class="fas fa-clock me-2"></i><strong>Hours:</strong> {{ office.working_hours }}</p>
                <p class="mb-1"><i class="fas fa-phone me-2"></i><strong>Phone:</strong> {{ office.phone }}</p>
                <p><i class="fas fa-envelope me-2"></i><strong>Email:</strong> 
                  <a href="mailto:{{ office.email }}" class="text-dark">{{ office.email }}</a>
                </p>
              </div>
            {% endfor %}
          </div>

          <!-- Map -->
          <div id="officeMap" class="rounded overflow-hidden shadow-sm" style="min-height:250px;">
            {% if offices %}
              <iframe
                id="officeMapFrame"
                src="{{ offices.0.google_map_link }}"
                width="100%"
                height="100%"
                style="border:0;"
                allowfullscreen=""
                loading="lazy">
              </iframe>
            {% endif %}
          </div>

          <small class="d-block mt-3 text-dark-50">
            <i class="fas fa-info-circle me-1"></i> Select an office tab to view address, hours, and contact details.
          </small>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
/* Bubble animation */
.bubbles span {
  position: absolute;
  bottom: -100px;
  width: 40px;
  height: 40px;
  background: rgba(255, 255, 255, 0.15);
  border-radius: 50%;
  animation: rise 20s infinite;
}
.bubbles span:nth-child(1) { left: 10%; animation-duration: 18s; }
.bubbles span:nth-child(2) { left: 25%; animation-duration: 22s; }
.bubbles span:nth-child(3) { left: 40%; animation-duration: 20s; }
.bubbles span:nth-child(4) { left: 55%; animation-duration: 25s; }
.bubbles span:nth-child(5) { left: 70%; animation-duration: 19s; }
.bubbles span:nth-child(6) { left: 85%; animation-duration: 23s; }

@keyframes rise {
  0% { transform: translateY(0) scale(1); opacity: 0.5; }
  50% { transform: translateY(-200px) scale(1.2); opacity: 0.7; }
  100% { transform: translateY(-500px) scale(1); opacity: 0; }
}

/* Tabs */
#officeTabs .nav-link {
  color: #ffffff !important;
  cursor: pointer;
}
#officeTabs .nav-link.active {
  background-color: #1e3a8a !important;
  color: #ffffff !important;
  border-radius: 50px;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const tabs = document.querySelectorAll("#officeTabs .nav-link");
  const panels = document.querySelectorAll("#officeDetails .office-panel");
  const mapFrame = document.getElementById("officeMapFrame");

  tabs.forEach((tab, index) => {
    tab.addEventListener("click", function() {
      // Remove active from all tabs
      tabs.forEach(t => t.classList.remove("active"));
      tab.classList.add("active");

      // Hide all panels
      panels.forEach(p => p.classList.add("d-none"));
      panels[index].classList.remove("d-none");

      // Update map
      const newMap = panels[index].dataset.map;
      mapFrame.src = newMap;
    });
  });
});
</script>
