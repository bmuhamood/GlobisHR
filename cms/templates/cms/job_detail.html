{% extends 'cms/base.html' %}
{% load static %}

{% block title %}{{ job.title }} - Globis HR Solutions{% endblock %}

{% block content %}
<div style="padding-top: 80px;"></div>

<section class="section py-5" style="background: var(--background-light);">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-9">

        <!-- Job Card -->
        <div class="card shadow-sm border-0 rounded-3 p-4 mb-4">
          <!-- Job Header -->
          <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
            <div>
              <h1 class="fw-bold mb-2">{{ job.title }}</h1>
              <p class="text-muted mb-2">
                <i class="fas fa-map-marker-alt me-2 text-primary"></i>{{ job.location }}
                <span class="ms-3">
                  <i class="fas fa-clock me-2 text-primary"></i>Posted {{ job.posted_at|timesince }} ago
                </span>
              </p>
              <div class="d-flex flex-wrap gap-2">
                <span class="badge bg-primary-subtle text-primary px-3 py-2">
                  <i class="fas fa-briefcase me-1"></i> {{ job.get_job_type_display }}
                </span>
                <span class="badge bg-info-subtle text-info px-3 py-2">
                  <i class="fas fa-layer-group me-1"></i> {{ job.get_work_scope_display }}
                </span>
                {% if job.salary_range %}
                <span class="badge bg-success-subtle text-success px-3 py-2">
                  <i class="fas fa-money-bill-wave me-1"></i> {{ job.salary_range }}
                </span>
                {% endif %}
              </div>
            </div>
          </div>

          <hr class="my-4">

          <!-- Job Description -->
          <div>
            <h5 class="fw-bold mb-3">Job Description</h5>
            <div class="text-muted lh-lg">
              {{ job.description|linebreaks }}
            </div>
          </div>

          <!-- Apply Button -->
          <div class="mt-4 text-center">
            <button class="btn btn-primary-custom btn-lg px-5" 
                    onclick="openApplicationForm('{{ job.title }}', {{ job.id }})">
              <i class="fas fa-paper-plane me-2"></i> Apply Now
            </button>
          </div>
        </div>

        <!-- Suggested Jobs -->
        <div class="mt-5">
          <h4 class="fw-bold mb-3">You may also like</h4>
          <div class="row g-3">
            {% for related in related_jobs %}
            <div class="col-md-6">
              <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                  <h6 class="fw-bold mb-2">{{ related.title }}</h6>
                  <p class="text-muted small mb-2">
                    <i class="fas fa-map-marker-alt me-1 text-primary"></i> {{ related.location }}
                  </p>
                  <a href="{% url 'cms:job_detail' related.id %}" 
                     class="stretched-link text-decoration-none small fw-semibold text-primary">
                    View Details â†’
                  </a>
                </div>
              </div>
            </div>
            {% empty %}
            <p class="text-muted">No related jobs found.</p>
            {% endfor %}
          </div>
        </div>

      </div>
    </div>
  </div>
</section>

{% include 'cms/partials/_job_modal.html' %}
{% endblock %}

{% block extra_js %}
<script>
const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]')?.value;

function openApplicationForm(jobTitle, jobId) {
  document.getElementById('appJobTitle').value = jobTitle;
  document.getElementById('appJobId').value = jobId;
  const modal = new bootstrap.Modal(document.getElementById('applicationModal'));
  modal.show();
}
</script>
{% endblock %}
